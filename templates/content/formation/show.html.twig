{% extends 'base.html.twig' %}

{% block title %}
	{{ formations.nameFormation }}
{% endblock %}
{% block stylesheets %}
	<link href="../css/fichier.css" rel="stylesheet"/>

	<link href="../css/showforma.css?v=30" rel="stylesheet"/>
	<!-- jQuery -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<!-- jQuery UI -->
	<script src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js"></script>
	<!-- CSS jQuery UI -->
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css">
<style>
.btn-calendly-detail {
    background-color: #0b3f89;
    color: white;
    padding: 12px 24px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: bold;
    display: inline-block;
    transition: background-color 0.3s ease;
}
.btn-calendly-detail:hover {
    background-color: #004080;
}
</style>

	
{% endblock %}



{% block body %}


	<div class="formation-container-body">
		<div class="formation-container">
			<div class="col-gauche-card">
				<h1 class="title-formation">{{ formations.nameFormation }}</h1>
				<div class="formation-details-gauche">
					<p>
						<strong style="color: #0b3e6fd6;">Description:</strong>
						{{ formations.descriptionFormation }}</p>

				</div>
			</div>
			<div
				class="col-droite-card">
				<!-- Correction ici -->
				<div
					class="formation-details-droite">
					<!-- Niveau, seulement si disponible -->
					{% if formations.niveau %}
						<p>
							<img src="{{ asset('img/les-niveaux.png') }}" style="width: 16px;" alt="icone formation">
							<strong style="color: #0b3e6fd6;">Niveau:</strong>
							{{ formations.niveau }}
						</p>
					{% endif %}

					<!-- Dur√©e, seulement si disponible -->
					{% if formations.dureeFormation %}
						<p>
							<img src="{{ asset('img/lhorloge.png') }}" style="width: 16px;" alt="icone formation">
							<strong style="color: #0b3e6fd6;">Dur√©e:</strong>
							{{ formations.dureeFormation }}
						</p>
					{% endif %}

					<!-- Langue, seulement si disponible -->
					{% if formations.langue %}
						<p>
							<img src="{{ asset('img/bloc-notes.png') }}" style="width: 16px;" alt="icone formation">
							<strong style="color: #0b3e6fd6;">Langue:</strong>
							{{ formations.langue }}
						</p>
					{% endif %}

					<!-- Prix, seulement si disponible -->
					{% if formations.priceFormation %}
						<p>
							<img src="{{ asset('img/piece-en-euros.png') }}" style="width: 16px;" alt="icone formation">
							<strong style="color: #0b3e6fd6;">Prix:</strong>
							{{ formations.priceFormation }}‚Ç¨
						</p>
					{% endif %}

					<!-- Code de certification RNCP, seulement si disponible -->
					{% if formations.rncp %}
						<p>
							<img src="{{ asset('img/certificate-icon.png') }}" style="width: 16px;" alt="icone RNCP">
							<strong style="color: #0b3e6fd6;">Code de certification :</strong>
							{{ formations.rncp }}
						</p>
					{% endif %}

					<!-- Environnement de formation (Lieu), seulement si disponible -->
					{% if formations.lieu %}
						<p>
							<img src="{{ asset('img/location-icon.png') }}" style="width: 16px;" alt="icone lieu">
							<strong style="color: #0b3e6fd6;">Environnement de formation :</strong>
							{{ formations.lieu }}
						</p>
					{% endif %}

					<!-- Composante de comp√©tences (Bloc), seulement si disponible -->
					{% if formations.bloc %}
						<p>
							<img src="{{ asset('img/skills-icon.gif') }}" style="width: 16px;" alt="icone bloc de comp√©tences">
							<strong style="color: #0b3e6fd6;">Composante de comp√©tences :</strong>
							{{ formations.bloc }}
						</p>
					{% endif %}
					<!-- Certificateur, seulement si disponible -->
					{% if formations.Certificateur %}
						<p>
							<img src="{{ asset('img/certificate-icon.png') }}" style="width: 16px;" alt="icone RNCP">
							<strong style="color: #0b3e6fd6;">Certificateur :</strong>
							{{ formations.Certificateur }}
						</p>
					{% endif %}
				</div>
			</div>
		</div>

		<div class="body-presentation-formation">
			<div class="col-gauche-navigation  hide-on-mobile">
				<img src="{{ asset('img/taff.jpg') }}" alt="Logo de la formation">
				<h3>Navigation</h3>
				<ul>
					<li><a href="#presentation">Pr√©sentation</a></li>
					<li><a href="#prerequis">Pr√©-requis</a></li>
					<li><a href="#atouts">Atouts</a></li>
					<li><a href="#programme">Programme</a></li>
					<li><a href="#duree">Dur√©e</a></li>
					<li><a href="#modalites">Modalit√©s p√©dagogiques</a></li>
					<li><a href="#evaluation">P√©dagogie - √âvaluation</a></li>
				</ul>
			</div>
			<div class="col-droite-presentation">
				<h2 id="presentation">Pr√©sentation</h2>
				<p>{{ formations.presentation }}</p>

				<h2 id="prerequis">Pr√©-requis</h2>
				<p class="keep-newlines">
                {{ formations.prerequis|escape|nl2br }}
                </p>

				<h2 id="atouts">Atouts</h2>
				<p>{{ formations.atouts }}</p>

				<h2 id="programme">Programme</h2>
				<p>{{ formations.programme }}</p>

				<h2 id="duree">Dur√©e</h2>
				<p>{{ formations.dureeFormation }}</p>

				<h2 id="modalites">Modalit√©s p√©dagogiques</h2>
				<p>{{ formations.modalitesPedagogique }}</p>

				<h2 id="evaluation">P√©dagogie - √âvaluation</h2>
				<p>{{ formations.evaluation }}</p>

				<div style="text-align:center; margin: 30px 0;">
				<a class="btn-calendly-detail" href="#" data-calendly-url="https://calendly.com/contact-infpf?locale=fr">
					üìÖ √âchanger avec un conseiller pour cette formation
				</a>
			</div>

			</div>

</div>
		<div
			class="button-programe-forma">
			<!-- Cr√©ation du lien de t√©l√©chargement -->
			<a href="{{ path('download_document', {'id': formations.id}) }}" download="{{ formations.nameFormation|replace({' ': '_', '/': '_', '\\': '_', ':': '_', '*': '_', '?': '_', '"': '_', '<': '_', '>': '_', '|': '_'}) ~ '.pdf'}}" class="download-button" style="background-color: #CE1353;">
				<span class="buttonforma">T√©l√©charger le programme</span>
			</a>
		</div>




    <div class="la">
        <div class="buttons-container">
            {% if formations.id == 89 %}
            <div class="button-programe-forma">
                <a href="https://www.moncompteformation.gouv.fr/espace-prive/html/#/formation/recherche/92791645200018_infpf15/92791645200018_infpf2" target="_blank" class="paiement-cpf-button">Voir sur le CPF</a>
            </div>
            {% elseif formations.id != 90 %}
            <div class="button-programe-forma">
                <a href="{{ path('create_checkout_session', {'productId': formations.id}) }}" class="paiement-cpf-button">Finan√ßable CPF</a>
            </div>
            {% endif %}
    
            <div class="button-programe-forma">
                <a href="{{ path('create_checkout_session', {'productId': formations.id}) }}" class="paiment-button">Paiement</a>
            </div>
        </div>
    </div>



	</div>

	<button class="btn_retour"><a href="{{ path('app_home') }}" id="href_btn">Revenir en arri√®re</a></button>

	{% if is_granted("ROLE_ADMIN") %}

		<button class="btn_modifier"><a href="{{ path('app_formation_edit', {'id': formations.id}) }}">Modifier</a></button>

		{{ include('content/formation/_delete_form.html.twig') }}
	{% endif %}

	{% include 'footer.html.twig' %}
{% endblock %}

{% block javascripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    /* ‚¨áÔ∏é on cible TOUS les <p> ... SAUF ceux qui portent .keep-newlines */
    const paragraphs = document.querySelectorAll(
        '.col-droite-presentation p:not(.keep-newlines)'
    );

    paragraphs.forEach(p => {
        p.innerHTML = p.innerHTML
            .replace(/\./g,  '.<br>')
            .replace(/:/g,  ':<br>')
            .replace(/-/g,  '<br>-')
            .replace(/‚Ä¢([^‚Ä¢<]*)/g, (_, txt) =>
                `<br>‚Ä¢<strong style="color:#0b3e6fd6;">${txt}</strong>`
            );
    });
});

</script>
<script type="text/javascript" src="https://assets.calendly.com/assets/external/widget.js" async></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const calendlyBtn = document.querySelector('.btn-calendly-detail');
    if (calendlyBtn) {
        calendlyBtn.addEventListener('click', function(e) {
            e.preventDefault();
            if (typeof Calendly !== 'undefined') {
                Calendly.initPopupWidget({
                    url: calendlyBtn.getAttribute('data-calendly-url')
                });
            } else {
                console.error("Calendly script non charg√©");
            }
        });
    }
});
</script>



{% endblock %}
